<!DOCTYPE html>
<html lang="es" >
  <head>
    <link rel="icon" type="image/png" href="favicon.png" />
    <meta charset="utf-8">
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, shrink-to-fit=no,maximum-scale=1.0, user-scalable=0' />
    <link rel="stylesheet" href="node_modules/animate.css/animate.min.css">
    <link rel="stylesheet" href="node_modules/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="node_modules/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="node_modules/spectre.css/dist/spectre-icons.min.css">
    <link rel="stylesheet" href="node_modules/flexboxgrid/dist/flexboxgrid.min.css">
    <link rel="stylesheet" href="node_modules/@material/elevation/dist/mdc.elevation.min.css">
    <title>Bliblia -Es</title>
  </head>
  <body>
   

        <div class="row animated fadeIn">
            <div class="col-xs-12 center-xs">
                <h1>Biblia</h1>
            </div>
        </div>
        <div class="divider"></div>


        <div class="row start-sm center-xs animated fadeIn">
            <div class="col-xs-11 col-sm-3 col-sm-offset-1 center-xs">
                <div class="form-group">
                      <select onchange="changeLibro(event)" id="libros" class="form-select">
                      </select>
                </div>
                    <div class="form-group">
                      <select id="capitulos" class="form-select" >
                      </select>
                </div>
            </div>
        </div>
        <div class="divider"></div>
        <div class="row center-xs">
            <div class="col-xs-12 start-xs animated fadeIn" id="content">
                    
            </div>
        </div>


<script src="node_modules/mithril/mithril.min.js"></script>
<script src="node_modules/underscore/underscore-min.js"></script>
<script src="node_modules/voca/index.js" ></script>
<script>
 
    var root    = document.body
    var content = document.getElementById("content");
    var libros  = document.getElementById("libros");


    function changeLibro( event ){
        m.route.set('/:libro/:capitulos', {capitulos: 1,libro:event.target.value})
    }


    async function f() {

  let promise = new Promise((resolve, reject) => {
    setTimeout(() => resolve("done!"), 1000)
  });

  let result = await promise; // wait until the promise resolves (*)

  alert(result); // "done!"
}

f();



  
    




    m.request({
        method: "GET",
        url: "libros.json",
    })
    .then(function(data) {
        m.render(libros,data.map((_d)=>{
            return m("option",{value:_d.val},_d.text)
       }));
    })




    var Data = {
        todos: {
            capitulos: [],
            fetch:function(libro) {

                console.log(  m.route.get() );
                
                m.request({
                    method: "GET",
                    url: "json/genesis.json",
                })
                .then(function(data){
                    Data.todos.capitulos = data
                })
            }
        }
    }



    var Splash = {
        view: function() {
            return m("a", {href: "#!/genesis/12"}, m.router, )
        }
    }

    var Biblia = {
        oninit: Data.todos.fetch,
        view: function(vnode){


            const libro = vnode.attrs.libro || "genesis" ;
            const capitulo = vnode.attrs.capitulo || "1" ;
        
            return _.map(Data.todos.capitulos[capitulo],function(cap,iterator){      
                return [m("div",{class:"col-xs-10 col-xs-offset-1"},[m("strong",iterator),m("p",cap)]),m("div",{class:"divider"})]
            });
           

        }
    }


    m.route(content, "/genesis/1", {
        "/:libro/:capitulo": Biblia
    })


    // your code goes here!
    </script>
      
  </body>
  </html>